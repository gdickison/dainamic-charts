CREATE VIEW banking_app.cex_race AS
SELECT
	"QINTRVYR" ::INTEGER AS year,
	"QINTRVMO" ::INTEGER AS month,
	TO_DATE (CONCAT ("QINTRVYR", "QINTRVMO"), 'YYYYMM') AS date,
	CASE
		WHEN "REGION" IS NOT NULL AND "REGION" != '' THEN "REGION" ::INTEGER
		WHEN "REGION" IS NULL OR "REGION" = '' THEN 0
	END AS region,
	CASE
		WHEN "REGION" = '1' THEN 'Northeast'
		WHEN "REGION" = '2' THEN 'Midwest'
		WHEN "REGION" = '3' THEN 'South'
		WHEN "REGION" = '4' THEN 'West'
		WHEN "REGION" IS NULL OR "REGION" = '' THEN 'none'
	END AS region_name,
	COUNT("NEWID") AS "total_sample",
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '1') AS NUMERIC) AS ct_white,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '1')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_white,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '1'), 2) AS inc_white,
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '2') AS NUMERIC) AS ct_black,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '2')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_black,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '2'), 2) AS inc_black,
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '3') AS NUMERIC) AS ct_native_american,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '3')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_native_american,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '3'), 2) AS inc_native_american,
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '4') AS NUMERIC) AS ct_asian,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '4')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_asian,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '4'), 2) AS inc_asian,
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '5') AS NUMERIC) AS ct_pacific_islander,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '5')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_pacific_islander,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '5'), 2) AS inc_pacific_islander,
  CAST(COUNT("NEWID") FILTER (WHERE "REF_RACE" = '6') AS NUMERIC) AS ct_mixed,
  ROUND((CAST((COUNT("NEWID") FILTER (WHERE "REF_RACE" = '6')) AS NUMERIC) / COUNT("NEWID")), 4) * 100 AS pct_mixed,
  ROUND(AVG("FINCBTAX" ::DECIMAL) FILTER (WHERE "REF_RACE" = '6'), 2) AS inc_mixed
FROM data_import.cex_pumd_fmli
GROUP BY "QINTRVYR", "QINTRVMO", "REGION"
ORDER BY year, date, region

CREATE TABLE banking_app.ubpr_institution AS
SELECT
  CAST("FED_RSSD" AS INTEGER) AS "BANK_ID",
	CAST("REPDTE" AS DATE) AS "AS_OF",
  "NAME",
  "ADDRESS",
  "CITY",
  "COUNTY",
  "STNAME",
  "ZIP",
  "MSA",
  "WEBADDR",
  "FDICREGN",
  "BKCLASS",
  "CLCODE",
  "DATEUPDT",
  "ASSET",
  CAST("ASSET" AS BIGINT) AS "ASSET_INT",
  "ROAPTX",
  "ROA",
  "DEPDOM",
  "DEP",
  "EQ",
  "ROE",
  "NETINC",
  "SPECGRPN",
  CAST("INSCOML" AS INTEGER),
  CAST("OFFICES" AS INTEGER)
FROM data_import.ubpr_institutions
WHERE "ACTIVE" = '1'
ORDER BY "BANK_ID";

CREATE TABLE banking_app.upbr_rcci_rcon AS
SELECT
  CAST("IDRSSD" AS INTEGER) AS "BANK_ID",
  CASE
    WHEN "REPORT_YEAR" = '2021' AND "REPORT_MONTH" = '3' THEN '2021-1'
    WHEN "REPORT_YEAR" = '2021' AND "REPORT_MONTH" = '6' THEN '2021-2'
    WHEN "REPORT_YEAR" = '2022' AND "REPORT_MONTH" = '3' THEN '2022-1'
    WHEN "REPORT_YEAR" = '2022' AND "REPORT_MONTH" = '6' THEN '2022-2'
  END AS "QUARTER",
  "RCON1288",
  "RCON1420",
  "RCON1460",
  "RCON1545",
  "RCON1590",
  "RCON1763",
  "RCON1764",
  "RCON1766",
  "RCON1797",
  "RCON2081",
  "RCON2107",
  "RCON2122",
  "RCON2123",
  "RCON2165",
  "RCON2746",
  "RCON5367",
  "RCON5368",
  "RCON5370",
  "RCONA247",
  "RCONA564",
  "RCONA565",
  "RCONA566",
  "RCONA567",
  "RCONA568",
  "RCONA569",
  "RCONA570",
  "RCONA571",
  "RCONA572",
  "RCONA573",
  "RCONA574",
  "RCONA575",
  "RCONB531",
  "RCONB534",
  "RCONB535",
  "RCONB538",
  "RCONB539",
  "RCONB837",
  "RCONC391",
  "RCONC779",
  "RCONC780",
  "RCONF158",
  "RCONF159",
  "RCONF160",
  "RCONF161",
  "RCONF162",
  "RCONF163",
  "RCONF230",
  "RCONF231",
  "RCONF232",
  "RCONF576",
  "RCONF577",
  "RCONG091",
  "RCONG092",
  "RCONG093",
  "RCONG094",
  "RCONG095",
  "RCONG096",
  "RCONG097",
  "RCONG098",
  "RCONG099",
  "RCONG100",
  "RCONG101",
  "RCONG102",
  "RCONG376",
  "RCONG378",
  "RCONGW45",
  "RCONGW46",
  "RCONGW47",
  "RCONHK25",
  "RCONJ451",
  "RCONJ454",
  "RCONJ464",
  "RCONJ466",
  "RCONJ467",
  "RCONJ468",
  "RCONJ469",
  "RCONJ470",
  "RCONJ471",
  "RCONK098",
  "RCONK137",
  "RCONK158",
  "RCONK159",
  "RCONK160",
  "RCONK161",
  "RCONK162",
  "RCONK163",
  "RCONK164",
  "RCONK165",
  "RCONK166",
  "RCONK168",
  "RCONK203",
  "RCONK204",
  "RCONK207",
  "RCONK256",
  "RCONLE75",
  "RCONLG24",
  "RCONLG25"
FROM data_import.ubpr_rcci;


SELECT
  r."IDRSSD" AS "BANK_ID",
  CASE
    WHEN r."REPORT_YEAR" = '2021' AND r."REPORT_MONTH" = '3' THEN '2021-1'
    WHEN r."REPORT_YEAR" = '2021' AND r."REPORT_MONTH" = '6' THEN '2021-2'
    WHEN r."REPORT_YEAR" = '2022' AND r."REPORT_MONTH" = '3' THEN '2022-1'
    WHEN r."REPORT_YEAR" = '2022' AND r."REPORT_MONTH" = '6' THEN '2022-2'
  END AS "QUARTER",
  r."REPORT_YEAR",
  r."REPORT_MONTH",
  i."NAME",
  i."ADDRESS",
  i."CITY",
  i."COUNTY",
  i."STNAME",
  i."ZIP",
  i."MSA",
  i."WEBADDR",
  i."FDICREGN",
  i."BKCLASS",
  i."CLCODE",
  i."DATEUPDT",
  i."ASSET",
  i."ROAPTX",
  i."ROA",
  i."DEPDOM",
  i."DEP",
  i."EQ",
  i."ROE",
  i."NETINC",
  i."SPECGRPN",
  r."RCON1288",
  r."RCON1420",
  r."RCON1460",
  r."RCON1545",
  r."RCON1590",
  r."RCON1763",
  r."RCON1764",
  r."RCON1766",
  r."RCON1797",
  r."RCON2081",
  r."RCON2107",
  r."RCON2122",
  r."RCON2123",
  r."RCON2165",
  r."RCON2746",
  r."RCON5367",
  r."RCON5368",
  r."RCON5370",
  r."RCONA247",
  r."RCONA564",
  r."RCONA565",
  r."RCONA566",
  r."RCONA567",
  r."RCONA568",
  r."RCONA569",
  r."RCONA570",
  r."RCONA571",
  r."RCONA572",
  r."RCONA573",
  r."RCONA574",
  r."RCONA575",
  r."RCONB531",
  r."RCONB534",
  r."RCONB535",
  r."RCONB538",
  r."RCONB539",
  r."RCONB837",
  r."RCONC391",
  r."RCONC779",
  r."RCONC780",
  r."RCONF158",
  r."RCONF159",
  r."RCONF160",
  r."RCONF161",
  r."RCONF162",
  r."RCONF163",
  r."RCONF230",
  r."RCONF231",
  r."RCONF232",
  r."RCONF576",
  r."RCONF577",
  r."RCONG091",
  r."RCONG092",
  r."RCONG093",
  r."RCONG094",
  r."RCONG095",
  r."RCONG096",
  r."RCONG097",
  r."RCONG098",
  r."RCONG099",
  r."RCONG100",
  r."RCONG101",
  r."RCONG102",
  r."RCONG376",
  r."RCONG378",
  r."RCONGW45",
  r."RCONGW46",
  r."RCONGW47",
  r."RCONHK25",
  r."RCONJ451",
  r."RCONJ454",
  r."RCONJ464",
  r."RCONJ466",
  r."RCONJ467",
  r."RCONJ468",
  r."RCONJ469",
  r."RCONJ470",
  r."RCONJ471",
  r."RCONK098",
  r."RCONK137",
  r."RCONK158",
  r."RCONK159",
  r."RCONK160",
  r."RCONK161",
  r."RCONK162",
  r."RCONK163",
  r."RCONK164",
  r."RCONK165",
  r."RCONK166",
  r."RCONK168",
  r."RCONK203",
  r."RCONK204",
  r."RCONK207",
  r."RCONK256",
  r."RCONLE75",
  r."RCONLG24",
  r."RCONLG25"
FROM data_import.ubpr_rcci r
  JOIN data_import.ubpr_institutions i
		ON r."IDRSSD" = i."FED_RSSD"
WHERE i."ACTIVE" = '1'
ORDER BY "QUARTER"

SELECT
  "ID RSSD" AS "BANK_ID",
  CASE
    WHEN "Reporting Period" LIKE '3/31/2019%' THEN '2019-1'
    WHEN "Reporting Period" LIKE '6/30/2019%' THEN '2019-2'
    WHEN "Reporting Period" LIKE '9/30/2019%' THEN '2019-3'
    WHEN "Reporting Period" LIKE '12/31/2019%' THEN '2019-4'
    WHEN "Reporting Period" LIKE '3/31/2020%' THEN '2020-1'
    WHEN "Reporting Period" LIKE '6/30/2020%' THEN '2020-2'
    WHEN "Reporting Period" LIKE '9/30/2020%' THEN '2020-3'
    WHEN "Reporting Period" LIKE '12/31/2020%' THEN '2020-4'
    WHEN "Reporting Period" LIKE '3/31/2021%' THEN '2021-1'
    WHEN "Reporting Period" LIKE '6/30/2021%' THEN '2021-2'
    WHEN "Reporting Period" LIKE '9/30/2021%' THEN '2021-3'
    WHEN "Reporting Period" LIKE '12/31/2021%' THEN '2021-4'
    WHEN "Reporting Period" LIKE '3/31/2022%' THEN '2022-1'
    WHEN "Reporting Period" LIKE '6/30/2022%' THEN '2022-2'
    WHEN "Reporting Period" LIKE '9/30/2022%' THEN '2022-3'
  END AS "QUARTER"
  "UBPRD490",
  "UBPRD646",
  "UBPRD647",
  "UBPRD648",
  "UBPRD649",
  "UBPRD650",
  "UBPRE392",
  "UBPRE632",
  "UBPRE657",
  "UBPRE658",
  "UBPRE663",
  "UBPRE880",
  "UBPRE881",
  "UBPRE882",
  "UBPRE883",
  "UBPRE884",
  "UBPRE885",
  "UBPRE886",
  "UBPRE887",
  "UBPRE888",
  "UBPRE889",
  "UBPRE890",
  "UBPRE891",
  "UBPRE892",
  "UBPRE893",
  "UBPRE894",
  "UBPRE895",
  "UBPRFB78",
  "UBPRFB79",
  "UBPRFB80",
  "UBPRFB81",
  "UBPRFB82",
  "UBPRFB83",
  "UBPRNL33"
FROM data_import.ubpr_credit_concentrations
ORDER BY "BANK_ID";

-- COLUMNS FOR UBPR_RCCI
"RCFD1410",
"RCFD1563",
"RCFD1590",
"RCFD1616",
"RCFD1763",
"RCFD1764",
"RCFD2011",
"RCFD2081",
"RCFD2107",
"RCFD2122",
"RCFD2123",
"RCFD2182",
"RCFD2183",
"RCFD2746",
"RCFDA247",
"RCFDA570",
"RCFDA571",
"RCFDA572",
"RCFDA573",
"RCFDA574",
"RCFDA575",
"RCFDB532",
"RCFDB533",
"RCFDB534",
"RCFDB536",
"RCFDB537",
"RCFDB538",
"RCFDB539",
"RCFDB837",
"RCON1288",
"RCON1415",
"RCON1420",
"RCON1460",
"RCON1480",
"RCON1545",
"RCON1563",
"RCON1564",
"RCON1590",
"RCON1616",
"RCON1763",
"RCON1764",
"RCON1766",
"RCON1797",
"RCON2011",
"RCON2081",
"RCON2107",
"RCON2122",
"RCON2123",
"RCON2165",
"RCON2182",
"RCON2183",
"RCON2746",
"RCON5367",
"RCON5368",
"RCON5370",
"RCONA247",
"RCONA564",
"RCONA565",
"RCONA566",
"RCONA567",
"RCONA568",
"RCONA569",
"RCONA570",
"RCONA571",
"RCONA572",
"RCONA573",
"RCONA574",
"RCONA575",
"RCONB531",
"RCONB532",
"RCONB533",
"RCONB534",
"RCONB535",
"RCONB536",
"RCONB537",
"RCONB538",
"RCONB539",
"RCONB837",
"RCFDC391",
"RCONC391",
"RCFDC779",
"RCFDC780",
"RCONC779",
"RCONC780",
"RCFDF162",
"RCFDF163",
"RCONF158",
"RCONF159",
"RCONF160",
"RCONF161",
"RCONF162",
"RCONF163",
"RCONF230",
"RCONF231",
"RCONF232",
"RCFDF585",
"RCFDF586",
"RCFDF587",
"RCFDF588",
"RCFDF589",
"RCFDF597",
"RCFDF598",
"RCFDF599",
"RCFDF600",
"RCFDF601",
"RCFDF608",
"RCFDF609",
"RCONF576",
"RCONF577",
"RCONF578",
"RCONF579",
"RCONF580",
"RCONF581",
"RCONF582",
"RCONF583",
"RCONF584",
"RCONF585",
"RCONF586",
"RCONF587",
"RCONF588",
"RCONF589",
"RCONF590",
"RCONF591",
"RCONF592",
"RCONF593",
"RCONF594",
"RCONF595",
"RCONF596",
"RCONF597",
"RCONF598",
"RCONF599",
"RCONF600",
"RCONF601",
"RCFDG091",
"RCFDG092",
"RCFDG093",
"RCFDG094",
"RCFDG095",
"RCFDG096",
"RCFDG097",
"RCFDG098",
"RCFDG099",
"RCFDG100",
"RCFDG101",
"RCFDG102",
"RCONG091",
"RCONG092",
"RCONG093",
"RCONG094",
"RCONG095",
"RCONG096",
"RCONG097",
"RCONG098",
"RCONG099",
"RCONG100",
"RCONG101",
"RCONG102",
"RCFDG378",
"RCONG376",
"RCONG378",
"RIADG377",
"RCONJ451",
"RCONJ454",
"RCONJ464",
"RCONJ466",
"RCONJ467",
"RCONJ468",
"RCONJ469",
"RCONJ470",
"RCONJ471",
"RCFDK098",
"RCFDK137",
"RCFDK163",
"RCFDK164",
"RCFDK165",
"RCFDK167",
"RCFDK168",
"RCFDK195",
"RCFDK196",
"RCFDK203",
"RCFDK204",
"RCFDK207",
"RCFDK208",
"RCFDK209",
"RCFDK212",
"RCFDK267",
"RCFNK289",
"RCONK098",
"RCONK137",
"RCONK158",
"RCONK159",
"RCONK160",
"RCONK161",
"RCONK162",
"RCONK163",
"RCONK164",
"RCONK165",
"RCONK166",
"RCONK167",
"RCONK168",
"RCONK195",
"RCONK196",
"RCONK203",
"RCONK204",
"RCONK207",
"RCONK208",
"RCONK209",
"RCONK212",
"RCONK256",
"RCONK267",
"RCFD1420",
"RCFD1460",
"RCFD1797",
"RCFD5367",
"RCFD5368",
"RCFDF158",
"RCFDF159",
"RCFDF160",
"RCFDF161",
"RCFDHK25",
"RCONGW45",
"RCONGW46",
"RCONGW47",
"RCONHK25",
"RCONLG24",
"RCONLG25",
"RCONLE75"

"QUARTER",
"BANK_ID",
"UBPR1400",
"UBPR1616",
"UBPR1658",
"UBPR1661",
"UBPR2150",
"UBPR5615",
"UBPR5616",
"UBPR5617",
"UBPRD667",
"UBPRD668",
"UBPRD669",
"UBPRD673",
"UBPRE473",
"UBPRE474",
"UBPRE475",
"UBPRE476",
"UBPRE477",
"UBPRE478",
"UBPRE479",
"UBPRE480",
"UBPRE481",
"UBPRE482",
"UBPRE483",
"UBPRE484",
"UBPRE485",
"UBPRE486",
"UBPRE487",
"UBPRE488",
"UBPRE489",
"UBPRE490",
"UBPRE491",
"UBPRE492",
"UBPRE493",
"UBPRE494",
"UBPRE495",
"UBPRE496",
"UBPRE505",
"UBPRE506",
"UBPRE507",
"UBPRE508",
"UBPRE509",
"UBPRE510",
"UBPRE511",
"UBPRE512",
"UBPRE513",
"UBPRE514",
"UBPRE515",
"UBPRE516",
"UBPRE517",
"UBPRE518",
"UBPRE519",
"UBPRE520",
"UBPRFB84",
"UBPRFB85",
"UBPRFB86",
"UBPRFB87",
"UBPRFB88",
"UBPRFB89",
"UBPRFB90",
"UBPRFB91",
"UBPRFB92",
"UBPRFB93",
"UBPRFB94",
"UBPRFB95",
"UBPRFB96",
"UBPRFB97",
"UBPRFB98",
"UBPRFB99",
"UBPRFC00",
"UBPRFC01",
"UBPRFC02",
"UBPRFC03",
"UBPRJ239",


('3/31/2022',321152,509,0,0,0,0,0,0,0,237,88,272,0,0.3,0.28,0.58,0.07,0,0,0,0,0,0,0,0,0.69,0.66,1.34,0.16,0,0,0,0,NULL,NULL,NULL,NULL,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.05,1,2.04,0.25,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0)
('6/30/2022',321152,260,0,0,0,0,0,0,0,0,285,260,0,0,0.21,0.21,0.25,0,0,0,0,0,0,0,0,0,0.49,0.49,0.59,0,0,0,0,NULL,NULL,NULL,NULL,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.63,0.63,0.76,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0)


"QUARTER",
"ID_RSSD",
"UBPR7414",
"UBPRE026",
"UBPRE497",
"UBPRE498",
"UBPRE499",
"UBPRE500",
"UBPRE501",
"UBPRE502",
"UBPRE503",
"UBPRE504",
"UBPRE521",
"UBPRE522",
"UBPRE523",
"UBPRE524",
"UBPRE529",
"UBPRE530",
"UBPRE531",
"UBPRE532",
"UBPRE533",
"UBPRE534",
"UBPRE535",
"UBPRE536",
"UBPRE537",
"UBPRE538",
"UBPRE539",
"UBPRE540",
"UBPRE541",
"UBPRE542",
"UBPRE544",
"UBPRE545",
"UBPRE546",
"UBPRE547",
"UBPRE549",
"UBPRE550",
"UBPRE551",
"UBPRE552",
"UBPRF896",
"UBPRFC07",
"UBPRFC08",
"UBPRFC09",
"UBPRFC10",
"UBPRFC11",
"UBPRFC12",
"UBPRFC13",
"UBPRFC14",
"UBPRFC15",
"UBPRFC16",
"UBPRFC17",
"UBPRFC18",
"UBPRFC19",
"UBPRFC20",
"UBPRFC21",
"UBPRFC22",
"UBPRK264",
"UBPRK265",
"UBPRK266",
"UBPRNC98"



('2016-12-31', '12/31/2016'),
('2017-12-31', '12/31/2017'),
('2018-12-31', '12/31/2018'),
('2019-12-31', '12/31/2019'),
('2020-12-31', '12/31/2020'),
('2021-12-31', '12/31/2021'),
('2016-3-31', '3/31/2016'),
('2017-3-31', '3/31/2017'),
('2018-3-31', '3/31/2018'),
('2019-3-31', '3/31/2019'),
('2020-3-31', '3/31/2020'),
('2021-3-31', '3/31/2021'),
('2022-3-31', '3/31/2022'),
('2016-6-30', '6/30/2016'),
('2017-6-30', '6/30/2017'),
('2018-6-30', '6/30/2018'),
('2019-6-30', '6/30/2019'),
('2020-6-30', '6/30/2020'),
('2021-6-30', '6/30/2021'),
('2022-6-30', '6/30/2022'),
('2016-9-30', '9/30/2016'),
('2017-9-30', '9/30/2017'),
('2018-9-30', '9/30/2018'),
('2019-9-30', '9/30/2019'),
('2020-9-30', '9/30/2020'),
('2021-9-30', '9/30/2021'),
('2022-9-30', '9/30/2022')

('2021-3-31', '3/31/2021'),
('2022-3-31', '3/31/2022'),
('2016-6-30', '6/30/2016'),
('2017-6-30', '6/30/2017'),
('2018-6-30', '6/30/2018'),
('2019-6-30', '6/30/2019'),
('2020-6-30', '6/30/2020'),
('2021-6-30', '6/30/2021'),
('2022-6-30', '6/30/2022'),
('2016-9-30', '9/30/2016'),
('2017-9-30', '9/30/2017'),
('2018-9-30', '9/30/2018'),
('2019-9-30', '9/30/2019'),
('2020-9-30', '9/30/2020'),
('2021-9-30', '9/30/2021'),
('2022-9-30', '9/30/2022')